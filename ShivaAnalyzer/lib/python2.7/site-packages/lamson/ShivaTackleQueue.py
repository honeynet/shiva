"""
Shiva - This module deals with analysis of spam retrived from queue (queuePath) 
The decision whether to relay mail or not is taken here and it's sub-modules

The variable msgMailRequest has been passed to all subsequent modules and functions. None of other module needs it but
process_message function needs this value. Could not find a direct way to assign this value to process_message, hence
the same value has been circulated throughout all modules/functions and ultimately it reaches process_message
"""
import server		# The core module of Lamson
import logging		
import ShivaMailParser	# Shiva - our customised module which parses all fields of an email
import ShivaConfig	# Shiva - centralised DB of global variables and settings
#import time, datetime

# Path to queue where LamsonHoneyMail dumps spams and later LamsonAnalyser picks from
queuePath = ShivaConfig.queuePath

def process_message(msgMailRequest):
  """
  Shiva - This function gets called only when a spam has to be relayed
  """
  # Bound to send a parameter to QueueReceiver as its __init__ needs at least one argument
  # Passing it variable queuePath as, anyway, variable queue_dir in server.py gets the same string from settings.py module
  processMessage = server.QueueReceiver(queuePath)				# Instantiating an object
  processMessage.process_message(msgMailRequest) 				# process_message sends msgMailRequest to router for delivery
	  

def tackleQueue(key, msgMailRequest, exeSql):
  """
  This function gets called from QueueReceiver function of module server.py
  """
  #logging.critical("[!] --------- Inside ShivaTackleQueue module -----------------")
	
  # Call to module that parses all the relevant fields of spam
  #spamParse.main(queuePath + key, msgMailRequest)
  ShivaMailParser.main(key, msgMailRequest, exeSql)
